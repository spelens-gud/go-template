// Code generated by gogenie-enum. DO NOT EDIT.
// Generate Hash: {{ .Hash }}
package {{ .Package }}

import (
	"database/sql/driver"
	"encoding/json"
	"fmt"
{{- if ne .BaseType "string" }}
	"strconv"
{{- end -}}
)

{{ if .Comment }}// {{ .Name }} {{ .Comment }}
{{ else }}// {{ .Name }} 枚举类型
{{ end }}type {{ .Name }} {{ .BaseType }}

{{- if .Values }}
const (
{{- range .Values }}
	{{- if .Comment }}
	// {{ .Comment }}
	{{- end }}
	{{ .Name }} {{ $.Name }} = {{ .Value }}
{{- end }}
)
{{- end }}

// String 返回 {{ .Name }} 的字符串表示
func (e {{ .Name }}) String() string {
	switch e {
{{- range .Values }}
	case {{ .Name }}:
		return "{{ .Name }}"
{{- end }}
	default:
		return "unknown {{ .Name }}"
	}
}

// Values 返回所有 {{ .Name }} 枚举值
func {{ .Name }}Values() []{{ .Name }} {
	return []{{ .Name }}{
{{- range .Values }}
		{{ .Name }},
{{- end }}
	}
}

// IsValid 检查值是否为有效的 {{ .Name }}
func (e {{ .Name }}) IsValid() bool {
	switch e {
{{- range .Values }}
	case {{ .Name }}:
		return true
{{- end }}
	default:
		return false
	}
}

{{- if eq .BaseType "string" }}
// Parse{{ .Name }} 从字符串解析 {{ .Name }} 枚举值
func Parse{{ .Name }}(s string) ({{ .Name }}, error) {
	switch s {
{{- range .Values }}
	case "{{ .Name }}":
		return {{ .Name }}, nil
{{- end }}
	default:
		return {{ .Name }}(""), fmt.Errorf("invalid {{ .Name }}: %s", s)
	}
}

// MustParse{{ .Name }} 从字符串解析 {{ .Name }} 枚举值，解析失败时 panic
func MustParse{{ .Name }}(s string) {{ .Name }} {
	e, err := Parse{{ .Name }}(s)
	if err != nil {
		panic(err)
	}
	return e
}
{{- else }}
// Parse{{ .Name }} 从 {{ .BaseType }} 解析 {{ .Name }} 枚举值
func Parse{{ .Name }}(v {{ .BaseType }}) ({{ .Name }}, error) {
	e := {{ .Name }}(v)
	if !e.IsValid() {
		return {{ .Name }}(0), fmt.Errorf("invalid {{ .Name }}: %v", v)
	}
	return e, nil
}

// MustParse{{ .Name }} 从 {{ .BaseType }} 解析 {{ .Name }} 枚举值，解析失败时 panic
func MustParse{{ .Name }}(v {{ .BaseType }}) {{ .Name }} {
	e, err := Parse{{ .Name }}(v)
	if err != nil {
		panic(err)
	}
	return e
}
{{- end }}

// MarshalJSON 实现 json.Marshaler 接口
func (e {{ .Name }}) MarshalJSON() ([]byte, error) {
	return json.Marshal(e.String())
}

// UnmarshalJSON 实现 json.Unmarshaler 接口
func (e *{{ .Name }}) UnmarshalJSON(data []byte) error {
{{- if eq .BaseType "string" }}
	var s string
	if err := json.Unmarshal(data, &s); err != nil {
		return err
	}
	*e = MustParse{{ .Name }}(s)
{{- else }}
	// 先尝试从字符串解析（枚举名称）
	var s string
	if err := json.Unmarshal(data, &s); err == nil {
		// 尝试通过枚举名称匹配
		switch s {
{{- range .Values }}
		case "{{ .Name }}":
			*e = {{ .Name }}
			return nil
{{- end }}
		}
		// 如果名称匹配失败，尝试将字符串解析为数字
		if num, err := strconv.ParseInt(s, 10, 64); err == nil {
			parsed, err := Parse{{ .Name }}({{ .BaseType }}(num))
			if err != nil {
				return err
			}
			*e = parsed
			return nil
		}
	}
	// 尝试从数字解析
	var v {{ .BaseType }}
	if err := json.Unmarshal(data, &v); err != nil {
		return err
	}
	parsed, err := Parse{{ .Name }}(v)
	if err != nil {
		return err
	}
	*e = parsed
{{- end }}
	return nil
}

// Scan 实现 sql.Scanner 接口
func (e *{{ .Name }}) Scan(value interface{}) error {
	if value == nil {
		return nil
	}
	switch v := value.(type) {
{{- if eq .BaseType "string" }}
	case string:
		*e = MustParse{{ .Name }}(v)
	case []byte:
		*e = MustParse{{ .Name }}(string(v))
{{- else }}
	case int64:
		*e = {{ .Name }}(v)
	case int32:
		*e = {{ .Name }}(v)
	case int:
		*e = {{ .Name }}(v)
	case string:
		// 尝试通过枚举名称匹配
		switch v {
{{- range .Values }}
		case "{{ .Name }}":
			*e = {{ .Name }}
			return nil
{{- end }}
		}
		// 如果名称匹配失败，尝试解析为数字
		if num, err := strconv.ParseInt(v, 10, 64); err == nil {
			parsed, err := Parse{{ .Name }}({{ .BaseType }}(num))
			if err != nil {
				return fmt.Errorf("cannot scan %T into {{ .Name }}", value)
			}
			*e = parsed
		} else {
			return fmt.Errorf("cannot scan %T into {{ .Name }}", value)
		}
	case []byte:
		return e.Scan(string(v))
{{- end }}
	default:
		return fmt.Errorf("cannot scan %T into {{ .Name }}", value)
	}
	return nil
}

// Value 实现 driver.Valuer 接口
func (e {{ .Name }}) Value() (driver.Value, error) {
{{- if eq .BaseType "string" }}
	return string(e), nil
{{- else }}
	return int64(e), nil
{{- end }}
}
